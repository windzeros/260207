"""
ì˜ë¬¸ë²• í•™ìŠµ ë„ìš°ë¯¸ - Streamlit + Gemini API / OpenRouter
ì‚¬ìš©ìê°€ ì˜ë¬¸ë²•ì„ í€´ì¦ˆì™€ ë¬¸ì¥ êµì •ì„ í†µí•´ í•™ìŠµí•  ìˆ˜ ìˆëŠ” ì›¹ ì•±ì…ë‹ˆë‹¤.
Gemini API ë˜ëŠ” OpenRouter API ì¤‘ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
"""

import streamlit as st  # ì›¹ ì•± í”„ë ˆì„ì›Œí¬
from google import genai  # Gemini API ê³µì‹ ë¼ì´ë¸ŒëŸ¬ë¦¬
from openai import OpenAI  # OpenRouterëŠ” OpenAI í˜¸í™˜ APIë¥¼ ì‚¬ìš©

# ============================================================
# í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
# ============================================================
st.set_page_config(
    page_title="ì˜ë¬¸ë²• í•™ìŠµ ë„ìš°ë¯¸",  # ë¸Œë¼ìš°ì € íƒ­ ì œëª©
    page_icon="ğŸ“š",  # ë¸Œë¼ìš°ì € íƒ­ ì•„ì´ì½˜
    layout="centered",  # í˜ì´ì§€ ë ˆì´ì•„ì›ƒ (ê°€ìš´ë° ì •ë ¬)
)

# ============================================================
# ì‚¬ì´ë“œë°” - API ì œê³µì ì„ íƒ ë° API í‚¤ ì…ë ¥
# ============================================================
st.sidebar.title("âš™ï¸ ì„¤ì •")  # ì‚¬ì´ë“œë°” ì œëª©
st.sidebar.markdown("---")  # êµ¬ë¶„ì„ 

# API ì œê³µì ì„ íƒ (Gemini ë˜ëŠ” OpenRouter)
api_provider = st.sidebar.radio(
    "ğŸ¤– AI ì œê³µìë¥¼ ì„ íƒí•˜ì„¸ìš”",
    ["Gemini", "OpenRouter"],
    help="Gemini: Google AI Studioì—ì„œ ë°œê¸‰ë°›ì€ í‚¤ ì‚¬ìš©\nOpenRouter: OpenRouterì—ì„œ ë°œê¸‰ë°›ì€ í‚¤ ì‚¬ìš©",
)

# ì œê³µìë³„ ì„ íƒ ê°€ëŠ¥í•œ ëª¨ë¸ ëª©ë¡
GEMINI_MODELS = [
    "gemini-3-flash-preview",
    "gemini-2.5-flash-preview-05-20",
    "gemini-2.0-flash",
    "gemini-2.0-flash-lite",
    "gemini-1.5-flash",
    "gemini-1.5-pro",
]

OPENROUTER_MODELS = [
    "google/gemini-3-flash-preview",
    "google/gemini-3-pro-preview",
    "openai/gpt-4o-mini",
    "openai/gpt-4o",
    "anthropic/claude-sonnet-4",
    "anthropic/claude-haiku-4",
    "meta-llama/llama-4-maverick",
    "deepseek/deepseek-chat-v3-0324",
]

# ì„ íƒí•œ ì œê³µìì— ë”°ë¼ API í‚¤ ì…ë ¥ í•„ë“œì™€ ëª¨ë¸ ì„ íƒ í‘œì‹œ
if api_provider == "Gemini":
    api_key = st.sidebar.text_input(
        "ğŸ”‘ Gemini API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”",
        type="password",  # ì…ë ¥ê°’ì´ í™”ë©´ì— ë³´ì´ì§€ ì•Šë„ë¡ ì„¤ì •
        placeholder="API í‚¤ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”",
        help="Google AI Studio(https://aistudio.google.com/)ì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    )
    # Gemini ëª¨ë¸ ì„ íƒ
    selected_model = st.sidebar.selectbox(
        "ğŸ§  ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”",
        GEMINI_MODELS,
        help="ì‚¬ìš©í•  Gemini ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”",
    )
else:
    api_key = st.sidebar.text_input(
        "ğŸ”‘ OpenRouter API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”",
        type="password",  # ì…ë ¥ê°’ì´ í™”ë©´ì— ë³´ì´ì§€ ì•Šë„ë¡ ì„¤ì •
        placeholder="API í‚¤ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”",
        help="OpenRouter(https://openrouter.ai/)ì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    )
    # OpenRouter ëª¨ë¸ ì„ íƒ
    selected_model = st.sidebar.selectbox(
        "ğŸ§  ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”",
        OPENROUTER_MODELS,
        help="ì‚¬ìš©í•  OpenRouter ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”",
    )

# API í‚¤ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ê³  ì•± ì‹¤í–‰ì„ ë©ˆì¶¤
if not api_key:
    st.title("ğŸ“š ì˜ë¬¸ë²• í•™ìŠµ ë„ìš°ë¯¸")
    st.info("ğŸ‘ˆ ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ API ì œê³µìë¥¼ ì„ íƒí•˜ê³  API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    st.markdown(
        """
        ### ì´ ì•±ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤:
        - ğŸ§© **ë¬¸ë²• í€´ì¦ˆ** - ë‚œì´ë„ë³„ ì˜ë¬¸ë²• í€´ì¦ˆë¥¼ í’€ê³  AIì˜ ìƒì„¸í•œ ì„¤ëª…ì„ ë°›ì•„ë³´ì„¸ìš”
        - âœï¸ **ë¬¸ì¥ êµì •** - ì˜ì–´ ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´ AIê°€ ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì•„ êµì •í•´ì¤ë‹ˆë‹¤

        ### ì§€ì›í•˜ëŠ” AI ì œê³µì:
        - **Gemini** - Google AI Studioì—ì„œ API í‚¤ ë°œê¸‰
        - **OpenRouter** - OpenRouterì—ì„œ API í‚¤ ë°œê¸‰ (ë‹¤ì–‘í•œ ëª¨ë¸ ì‚¬ìš© ê°€ëŠ¥)
        """
    )
    st.stop()  # ì—¬ê¸°ì„œ ì•± ì‹¤í–‰ ì¤‘ë‹¨

# ============================================================
# API í´ë¼ì´ì–¸íŠ¸ ìƒì„± (ì„ íƒí•œ ì œê³µìì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì„¤ì •)
# ============================================================
if api_provider == "Gemini":
    # Gemini: google-genai ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ í´ë¼ì´ì–¸íŠ¸ ìƒì„±
    gemini_client = genai.Client(api_key=api_key)
else:
    # OpenRouter: OpenAI í˜¸í™˜ APIë¡œ í´ë¼ì´ì–¸íŠ¸ ìƒì„±
    openrouter_client = OpenAI(
        base_url="https://openrouter.ai/api/v1",  # OpenRouter API ì£¼ì†Œ
        api_key=api_key,
    )


# ============================================================
# AI API í˜¸ì¶œ í•¨ìˆ˜
# ============================================================
def ask_ai(prompt):
    """
    ì„ íƒí•œ AI ì œê³µìì— í”„ë¡¬í”„íŠ¸ë¥¼ ë³´ë‚´ê³  ì‘ë‹µ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
    - prompt: AIì—ê²Œ ë³´ë‚¼ ì§ˆë¬¸/ìš”ì²­ í…ìŠ¤íŠ¸
    - ë°˜í™˜ê°’: AIì˜ ì‘ë‹µ í…ìŠ¤íŠ¸
    """
    try:
        if api_provider == "Gemini":
            # Gemini API í˜¸ì¶œ
            response = gemini_client.models.generate_content(
                model=selected_model,  # ì‚¬ìš©í•  ëª¨ë¸ ì§€ì •
                contents=prompt,  # ë³´ë‚¼ í”„ë¡¬í”„íŠ¸
            )
            return response.text  # ì‘ë‹µ í…ìŠ¤íŠ¸ ë°˜í™˜
        else:
            # OpenRouter API í˜¸ì¶œ (OpenAI í˜¸í™˜ í˜•ì‹)
            response = openrouter_client.chat.completions.create(
                model=selected_model,  # ì‚¬ìš©í•  ëª¨ë¸ ì§€ì •
                messages=[{"role": "user", "content": prompt}],  # ë©”ì‹œì§€ í˜•ì‹
            )
            return response.choices[0].message.content  # ì‘ë‹µ í…ìŠ¤íŠ¸ ë°˜í™˜
    except Exception as e:
        # ì˜¤ë¥˜ ë°œìƒ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜
        return f"âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}"


# ============================================================
# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
# ============================================================
# Streamlitì€ ë§¤ë²ˆ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë¯€ë¡œ, ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë ¤ë©´ session_stateë¥¼ ì‚¬ìš©í•´ì•¼ í•¨

# í˜„ì¬ í€´ì¦ˆ ë¬¸ì œë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜ (ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ë¡œ ì´ˆê¸°í™”)
if "quiz_question" not in st.session_state:
    st.session_state.quiz_question = ""

# í€´ì¦ˆ ì •ë‹µ í™•ì¸ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
if "quiz_result" not in st.session_state:
    st.session_state.quiz_result = ""

# ë¬¸ì¥ êµì • ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
if "correction_result" not in st.session_state:
    st.session_state.correction_result = ""

# ============================================================
# ë©”ì¸ í˜ì´ì§€ í—¤ë”
# ============================================================
st.title("ğŸ“š ì˜ë¬¸ë²• í•™ìŠµ ë„ìš°ë¯¸")
st.markdown(f"**{api_provider}** AIì™€ í•¨ê»˜ ì˜ë¬¸ë²•ì„ í•™ìŠµí•´ë³´ì„¸ìš”!")
st.markdown("---")

# ============================================================
# íƒ­ êµ¬ì„± - ë¬¸ë²• í€´ì¦ˆ / ë¬¸ì¥ êµì •
# ============================================================
tab1, tab2 = st.tabs(["ğŸ§© ë¬¸ë²• í€´ì¦ˆ", "âœï¸ ë¬¸ì¥ êµì •"])

# ============================================================
# íƒ­ 1: ë¬¸ë²• í€´ì¦ˆ
# ============================================================
with tab1:
    st.header("ğŸ§© ì˜ë¬¸ë²• í€´ì¦ˆ")
    st.markdown("ë‚œì´ë„ë¥¼ ì„ íƒí•˜ê³  í€´ì¦ˆë¥¼ í’€ì–´ë³´ì„¸ìš”! AIê°€ ìƒì„¸í•˜ê²Œ ì„¤ëª…í•´ì¤ë‹ˆë‹¤.")

    # ë‚œì´ë„ ì„ íƒ ë“œë¡­ë‹¤ìš´ ë©”ë‰´
    difficulty = st.selectbox(
        "ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”",
        ["ì´ˆê¸‰ (Basic)", "ì¤‘ê¸‰ (Intermediate)", "ê³ ê¸‰ (Advanced)"],
        help="í•™ìŠµ ìˆ˜ì¤€ì— ë§ëŠ” ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”",
    )

    # "í€´ì¦ˆ ìƒì„±" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ AIê°€ í€´ì¦ˆë¥¼ ë§Œë“¤ì–´ì¤Œ
    if st.button("ğŸ² ìƒˆ í€´ì¦ˆ ìƒì„±", use_container_width=True):
        # ë¡œë”© ìŠ¤í”¼ë„ˆë¥¼ ë³´ì—¬ì£¼ë©´ì„œ AI ì‘ë‹µì„ ê¸°ë‹¤ë¦¼
        with st.spinner("í€´ì¦ˆë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."):
            # Geminiì—ê²Œ ë³´ë‚¼ í€´ì¦ˆ ìƒì„± í”„ë¡¬í”„íŠ¸
            quiz_prompt = f"""
ë‹¹ì‹ ì€ ì˜ì–´ ë¬¸ë²• ì „ë¬¸ êµì‚¬ì…ë‹ˆë‹¤. ë‹¤ìŒ ì¡°ê±´ì— ë§ëŠ” ì˜ë¬¸ë²• í€´ì¦ˆ 1ë¬¸ì œë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

ë‚œì´ë„: {difficulty}

í˜•ì‹:
1. ë¨¼ì € "ğŸ“ ë¬¸ì œ:" ë¡œ ì‹œì‘í•˜ì—¬ ë¹ˆì¹¸ ì±„ìš°ê¸° ë˜ëŠ” ì˜¤ë¥˜ ì°¾ê¸° ë¬¸ì œë¥¼ ì¶œì œí•˜ì„¸ìš”.
2. ë³´ê¸°ê°€ ìˆë‹¤ë©´ A, B, C, D 4ê°œì˜ ì„ íƒì§€ë¥¼ ì œê³µí•˜ì„¸ìš”.
3. ì•„ì§ ì •ë‹µê³¼ í•´ì„¤ì€ ë³´ì—¬ì£¼ì§€ ë§ˆì„¸ìš”.

ì£¼ì˜ì‚¬í•­:
- ì‹¤ìš©ì ì´ê³  ì¼ìƒì—ì„œ ìì£¼ ì“°ì´ëŠ” ë¬¸ë²•ì„ ë‹¤ë£¨ì„¸ìš”.
- ë¬¸ì œëŠ” ëª…í™•í•˜ê³  ì´í•´í•˜ê¸° ì‰¬ì›Œì•¼ í•©ë‹ˆë‹¤.
- í•œêµ­ì–´ë¡œ ì„¤ëª…í•˜ì„¸ìš”.
"""
            # AIì—ê²Œ í€´ì¦ˆ ìƒì„± ìš”ì²­
            result = ask_ai(quiz_prompt)
            # ìƒì„±ëœ í€´ì¦ˆë¥¼ ì„¸ì…˜ ìƒíƒœì— ì €ì¥
            st.session_state.quiz_question = result
            # ì´ì „ ì •ë‹µ í™•ì¸ ê²°ê³¼ ì´ˆê¸°í™”
            st.session_state.quiz_result = ""

    # í€´ì¦ˆê°€ ìƒì„±ë˜ì—ˆìœ¼ë©´ í™”ë©´ì— í‘œì‹œ
    if st.session_state.quiz_question:
        # í€´ì¦ˆ ë¬¸ì œë¥¼ íŒŒë€ìƒ‰ ë°•ìŠ¤ ì•ˆì— í‘œì‹œ
        st.markdown("---")
        st.markdown(st.session_state.quiz_question)
        st.markdown("---")

        # ì‚¬ìš©ìê°€ ë‹µë³€ì„ ì…ë ¥í•˜ëŠ” í…ìŠ¤íŠ¸ í•„ë“œ
        user_answer = st.text_input(
            "âœï¸ ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”",
            placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: A, B, C, D ë˜ëŠ” ì§ì ‘ ë‹µ ì‘ì„±)",
        )

        # "ì •ë‹µ í™•ì¸" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ AIê°€ ì±„ì í•˜ê³  ì„¤ëª…í•´ì¤Œ
        if st.button("âœ… ì •ë‹µ í™•ì¸", use_container_width=True):
            if user_answer:
                with st.spinner("ì •ë‹µì„ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤..."):
                    # Geminiì—ê²Œ ë³´ë‚¼ ì±„ì  í”„ë¡¬í”„íŠ¸
                    check_prompt = f"""
ë‹¹ì‹ ì€ ì˜ì–´ ë¬¸ë²• ì „ë¬¸ êµì‚¬ì…ë‹ˆë‹¤. ì•„ë˜ í€´ì¦ˆì— ëŒ€í•œ í•™ìƒì˜ ë‹µë³€ì„ ì±„ì í•´ì£¼ì„¸ìš”.

[í€´ì¦ˆ]
{st.session_state.quiz_question}

[í•™ìƒì˜ ë‹µë³€]
{user_answer}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”:
1. âœ… ì •ë‹µ ì—¬ë¶€ (ì •ë‹µ/ì˜¤ë‹µ)
2. ğŸ“Œ ì •ë‹µ: (ì˜¬ë°”ë¥¸ ë‹µ)
3. ğŸ“– í•´ì„¤: (ì™œ ì´ê²ƒì´ ì •ë‹µì¸ì§€ ìƒì„¸í•˜ê²Œ ì„¤ëª…. ê´€ë ¨ ë¬¸ë²• ê·œì¹™ë„ ì„¤ëª…)
4. ğŸ’¡ ì¶”ê°€ íŒ: (ì´ ë¬¸ë²•ê³¼ ê´€ë ¨ëœ ìœ ìš©í•œ íŒì´ë‚˜ ì£¼ì˜ì‚¬í•­)

í•œêµ­ì–´ë¡œ ì„¤ëª…í•˜ì„¸ìš”. ì´ˆë³´ìë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
"""
                    # AIì—ê²Œ ì±„ì  ìš”ì²­
                    result = ask_ai(check_prompt)
                    # ê²°ê³¼ë¥¼ ì„¸ì…˜ ìƒíƒœì— ì €ì¥
                    st.session_state.quiz_result = result
            else:
                # ë‹µë³€ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ì„ ë•Œ ê²½ê³  ë©”ì‹œì§€
                st.warning("ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!")

    # ì±„ì  ê²°ê³¼ê°€ ìˆìœ¼ë©´ í™”ë©´ì— í‘œì‹œ
    if st.session_state.quiz_result:
        st.markdown("### ğŸ“‹ ì±„ì  ê²°ê³¼")
        st.markdown(st.session_state.quiz_result)

# ============================================================
# íƒ­ 2: ë¬¸ì¥ êµì •
# ============================================================
with tab2:
    st.header("âœï¸ ë¬¸ì¥ êµì •")
    st.markdown("ì˜ì–´ ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´ AIê°€ ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì•„ êµì •í•´ì¤ë‹ˆë‹¤.")

    # ì‚¬ìš©ìê°€ êµì •ë°›ê³  ì‹¶ì€ ì˜ì–´ ë¬¸ì¥ì„ ì…ë ¥í•˜ëŠ” í…ìŠ¤íŠ¸ ì˜ì—­
    user_sentence = st.text_area(
        "êµì •ë°›ê³  ì‹¶ì€ ì˜ì–´ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”",
        placeholder="ì˜ˆ: I have went to the store yesterday.",
        height=120,  # ì…ë ¥ ì˜ì—­ ë†’ì´
        help="ì˜ì–´ ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´ AIê°€ ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì•„ ì„¤ëª…í•´ì¤ë‹ˆë‹¤.",
    )

    # "ë¬¸ì¥ êµì •í•˜ê¸°" ë²„íŠ¼
    if st.button("ğŸ” ë¬¸ì¥ êµì •í•˜ê¸°", use_container_width=True):
        if user_sentence:
            with st.spinner("ë¬¸ì¥ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤..."):
                # Geminiì—ê²Œ ë³´ë‚¼ ë¬¸ì¥ êµì • í”„ë¡¬í”„íŠ¸
                correction_prompt = f"""
ë‹¹ì‹ ì€ ì˜ì–´ ë¬¸ë²• ì „ë¬¸ êµì‚¬ì…ë‹ˆë‹¤. ì•„ë˜ ì˜ì–´ ë¬¸ì¥ì˜ ë¬¸ë²•ì„ ë¶„ì„í•˜ê³  êµì •í•´ì£¼ì„¸ìš”.

[ì…ë ¥ ë¬¸ì¥]
{user_sentence}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”:

1. ğŸ“ ì›ë¬¸: (ì…ë ¥ëœ ë¬¸ì¥)
2. âœ… êµì •ë¬¸: (êµì •ëœ ë¬¸ì¥)
3. ğŸ” ì˜¤ë¥˜ ë¶„ì„:
   - ê° ì˜¤ë¥˜ë¥¼ í•˜ë‚˜ì”© ì„¤ëª… (ì–´ë–¤ ë¶€ë¶„ì´ ì˜ëª»ë˜ì—ˆê³ , ì™œ ì˜ëª»ë˜ì—ˆëŠ”ì§€)
   - ì˜¬ë°”ë¥¸ ë¬¸ë²• ê·œì¹™ ì„¤ëª…
4. ğŸ“– ë¬¸ë²• í¬ì¸íŠ¸: (ì´ ë¬¸ì¥ì—ì„œ ë°°ìš¸ ìˆ˜ ìˆëŠ” í•µì‹¬ ë¬¸ë²• ì‚¬í•­ ì •ë¦¬)
5. ğŸ’¡ ë¹„ìŠ·í•œ ì˜ˆë¬¸: (ì˜¬ë°”ë¥¸ ë¬¸ë²•ì„ ì‚¬ìš©í•œ ë¹„ìŠ·í•œ ì˜ˆë¬¸ 2-3ê°œ)

ë§Œì•½ ë¬¸ì¥ì— ì˜¤ë¥˜ê°€ ì—†ë‹¤ë©´, ë¬¸ì¥ì´ ì˜¬ë°”ë¥´ë‹¤ê³  ì•Œë ¤ì£¼ê³  ì‚¬ìš©ëœ ë¬¸ë²•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.
í•œêµ­ì–´ë¡œ ì„¤ëª…í•˜ì„¸ìš”. ì´ˆë³´ìë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
"""
                # AIì—ê²Œ êµì • ìš”ì²­
                result = ask_ai(correction_prompt)
                # ê²°ê³¼ë¥¼ ì„¸ì…˜ ìƒíƒœì— ì €ì¥
                st.session_state.correction_result = result
        else:
            # ë¬¸ì¥ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ì„ ë•Œ ê²½ê³  ë©”ì‹œì§€
            st.warning("êµì •í•  ì˜ì–´ ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!")

    # êµì • ê²°ê³¼ê°€ ìˆìœ¼ë©´ í™”ë©´ì— í‘œì‹œ
    if st.session_state.correction_result:
        st.markdown("### ğŸ“‹ êµì • ê²°ê³¼")
        st.markdown(st.session_state.correction_result)

# ============================================================
# ì‚¬ì´ë“œë°” í•˜ë‹¨ - ì•± ì •ë³´
# ============================================================
st.sidebar.markdown("---")
st.sidebar.markdown("### ğŸ“Œ ì‚¬ìš© ë°©ë²•")
st.sidebar.markdown(
    """
1. AI ì œê³µìë¥¼ ì„ íƒí•˜ì„¸ìš” (Gemini / OpenRouter)
2. API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”
3. **ë¬¸ë²• í€´ì¦ˆ** íƒ­ì—ì„œ í€´ì¦ˆë¥¼ í’€ì–´ë³´ì„¸ìš”
4. **ë¬¸ì¥ êµì •** íƒ­ì—ì„œ ë¬¸ì¥ì„ êµì •ë°›ìœ¼ì„¸ìš”
"""
)
st.sidebar.markdown("---")
# í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ AI ì œê³µìì™€ ëª¨ë¸ í‘œì‹œ
st.sidebar.caption(f"Powered by {api_provider} ({selected_model})")
